% !TeX encoding = UTF-8
% !TeX spellcheck = fr_FR


\definecolor{couleurbackintr}{HTML}{7F00FF}
\definecolor{couleurtextintr}{HTML}{FFFFFF}
\definecolor{couleurbackfonc}{HTML}{C780FF}
\definecolor{couleurtext}{HTML}{000000}
\definecolor{couleurbackextr}{HTML}{DDB3FF}

\newcommand{\multiliens}[2]{\foreach \noeud in {#1} {\draw[<-] (#2.west) -| ++(-1em,0em) |- (\noeud.east);}}
\newcommand{\lienhorz}[2]{\draw[->] (#1.east) -- (#2.west);}
\newcommand{\lienvtht}[2]{\draw[->] (#1.north) -- (#2.south);}
\newcommand{\lienvtbs}[2]{\draw[->] (#1.south) -- (#2.north);}


\begin{figure}[htp]
	\centering
	\tikzset{
		basic/.style={draw, rounded corners=2pt, thick, text width=8em, align=flush center, text=couleurtext, node distance=2em},
		intrant/.style={basic, fill=couleurbackintr, text=couleurtextintr},
		fonction/.style={basic, fill=couleurbackfonc},
		extrant/.style={basic, fill=couleurbackextr}
	}
	\begin{tikzpicture}[]
		\fontsize{10}{9} \selectfont
		% intrants
		\matrix[row sep=2em, column sep=2em] {
			% 1re ligne
			% TODO changer nom
			\node[intrant](forcutil){Force utilisée}; & \node[fonction](instcapt){Installer capteur sous l'eau}; & & & \node[extrant](captinst){Capteur installé}; \\
			% 2me ligne
			\node[intrant](defailla){Défaillance}; & \node[fonction](detcdefa){Détecter défaillance}; & & \node[fonction](genralrm){Générer alarme}; & \node[extrant](alarme){Alarme}; \\
			% 3me ligne
			\node[intrant](poissons){Poissons}; & \node[fonction](detecteu){Détecteur}; & \node[fonction](photo){Photo}; & \node[fonction](accudonn){Accumuler données}; & \\
			% 4me ligne
			\node[intrant](elecbatt){Électicité batterie}; & \node[fonction](alimcapt){Alimenter capteur}; & & \node[fonction](idenpois){Identifier poisson}; & \\
			% 5me ligne
			\node[intrant](tempreau){Température de l'eau}; & \node[fonction](captteau){Capteur température eau}; & & \node[fonction](archdonn){Archiver donnéees}; & \node[extrant](donnarch){Données archivées}; \\
			% 6me ligne
			\node[intrant](tempintr){Température interne}; & \node[fonction](capttcpt){Capteur température interne}; & & & \\
			% 7me ligne
			\node[intrant](confvolm){Configuration volume}; & \node[fonction](confcapt){Configurer capteur}; & & & \\
			% 8me ligne
			\node[intrant](entrutil){Entrées utilisateurs}; & \node[fonction](authutil){Authentifier utilisateur}; & \node[fonction](accedonn){Accéder aux données}; & & \\
		};
		
		% Liens
		\lienhorz{forcutil}{instcapt}
		\lienhorz{defailla}{detcdefa}
		\lienhorz{poissons}{detecteu}
		\lienhorz{elecbatt}{alimcapt}
		\lienhorz{tempreau}{captteau}
		\lienhorz{tempintr}{capttcpt}
		\lienhorz{confvolm}{confcapt}
		\lienhorz{entrutil}{authutil}
		
		\lienhorz{detcdefa}{genralrm}
		\lienhorz{instcapt}{captinst}
		
		\lienvtht{authutil}{confcapt}
	\end{tikzpicture}
	\caption{Diagramme fonctionnel}
	\label{f:caf_diag_fonc}
\end{figure}